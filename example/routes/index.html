<:Head>
	<title>Sapper project template</title>
</:Head>

<Layout page='home'>
	<h1>svelte-apollo</h1>
	{{#await posts}}
		<p>Loading...</p>
	{{then data}}
		<ul>
			{{#each data.posts as post}}
				<li>{{post.title}} by {{post.author.firstName}} {{post.author.lastName}} &mdash; {{post.votes}} votes</li>
				<button on:click="upvote(post.id)">Upvote</button>
			{{/each}}
		</ul>
	{{catch error}}
		<p>Request Failed</p>
	{{/await}}
</Layout>

<style>
	
</style>

<script>
	import Layout from './_components/Layout.html';
	import gql from 'graphql-tag';
	import { query, mutate, connect, disconnect } from '../../';

	export default {
		components: {
			Layout
		},

		data: () => ({
      posts: query(gql`{
        posts {
					id
          title
          author {
						firstName,
						lastName
					},
					votes
        }
      }`)
		}),

		oncreate: connect,
		ondestroy: disconnect,

		methods: {
			upvote: mutate(postId => gql`
        mutation upvotePost {
          upvotePost(postId: ${postId}) {
            id
            title
            votes
          }
        }
      `)
		}
	};
</script>
